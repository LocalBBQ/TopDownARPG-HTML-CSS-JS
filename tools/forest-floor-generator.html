<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forest floor texture generator</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 16px; background: #1a1a1a; color: #ddd; }
    h1 { font-size: 1.1rem; }
    .controls { margin: 12px 0; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    label { display: flex; align-items: center; gap: 6px; }
    button { padding: 8px 14px; cursor: pointer; background: #3a5a3a; color: #eee; border: none; border-radius: 4px; }
    button:hover { background: #4a6a4a; }
    #preview { margin-top: 12px; image-rendering: pixelated; image-rendering: crisp-edges; }
    .tiled { background: url('') repeat; }
  </style>
</head>
<body>
  <h1>Forest floor (tileable noise)</h1>
  <div class="controls">
    <label>Size: <input type="number" id="size" value="32" min="16" max="128" /></label>
    <label>Grid: <input type="number" id="gridSize" value="8" min="2" max="16" /></label>
    <label>Dark soil <input type="color" id="colorDark" value="#2a2318" /></label>
    <label>Mid <input type="color" id="colorMid" value="#3d3525" /></label>
    <label>Light <input type="color" id="colorLight" value="#4f4532" /></label>
    <label>Moss (amount 0–1) <input type="number" id="mossAmount" value="0.15" min="0" max="1" step="0.05" /></label>
    <button id="generate">Generate</button>
    <button id="download">Download PNG</button>
  </div>
  <p>Single tile:</p>
  <canvas id="preview" width="32" height="32"></canvas>
  <p style="margin-top: 16px;">Tiled 4×4:</p>
  <canvas id="tiled" width="128" height="128"></canvas>

  <script>
    const sizeInput = document.getElementById("size");
    const gridInput = document.getElementById("gridSize");
    const colorDark = document.getElementById("colorDark");
    const colorMid = document.getElementById("colorMid");
    const colorLight = document.getElementById("colorLight");
    const mossAmount = document.getElementById("mossAmount");
    const preview = document.getElementById("preview");
    const tiled = document.getElementById("tiled");

    function parseHex(hex) {
      const n = parseInt(hex.slice(1), 16);
      return [(n >> 16) & 0xff, (n >> 8) & 0xff, n & 0xff];
    }

    function lerpColor(a, b, t) {
      return [
        Math.round(a[0] + (b[0] - a[0]) * t),
        Math.round(a[1] + (b[1] - a[1]) * t),
        Math.round(a[2] + (b[2] - a[2]) * t)
      ];
    }

    function generate() {
      const size = Math.max(16, Math.min(128, parseInt(sizeInput.value, 10) || 32));
      const gridSize = Math.max(2, Math.min(16, parseInt(gridInput.value, 10) || 8));

      const canvas = document.createElement("canvas");
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext("2d");
      const imageData = ctx.createImageData(size, size);

      const grid = [];
      const mossGrid = [];
      for (let y = 0; y <= gridSize; y++) {
        grid[y] = [];
        mossGrid[y] = [];
        for (let x = 0; x <= gridSize; x++) {
          grid[y][x] = Math.random();
          mossGrid[y][x] = Math.random();
        }
      }

      const fade = t => t * t * (3 - 2 * t);

      function sample(g, x, y) {
        const gx = (x / size) * gridSize;
        const gy = (y / size) * gridSize;
        const x0 = Math.floor(gx) % (gridSize + 1);
        const y0 = Math.floor(gy) % (gridSize + 1);
        const x1 = (x0 + 1) % (gridSize + 1);
        const y1 = (y0 + 1) % (gridSize + 1);
        const sx = fade(gx - Math.floor(gx));
        const sy = fade(gy - Math.floor(gy));
        const n00 = g[y0][x0], n10 = g[y0][x1], n01 = g[y1][x0], n11 = g[y1][x1];
        const ix0 = n00 * (1 - sx) + n10 * sx;
        const ix1 = n01 * (1 - sx) + n11 * sx;
        return ix0 * (1 - sy) + ix1 * sy;
      }

      const dark = parseHex(colorDark.value);
      const mid = parseHex(colorMid.value);
      const light = parseHex(colorLight.value);
      const mossColor = [40, 55, 35];
      const moss = Math.max(0, Math.min(1, parseFloat(mossAmount.value) || 0));

      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          const n = sample(grid, x, y);
          const m = sample(mossGrid, x, y);
          // Forest floor: blend dark -> mid -> light by noise
          const t = n;
          let r, g, b;
          if (t < 0.5) {
            const s = t * 2;
            [r, g, b] = lerpColor(dark, mid, s);
          } else {
            const s = (t - 0.5) * 2;
            [r, g, b] = lerpColor(mid, light, s);
          }
          // Subtle moss in low areas (where noise is low)
          if (moss > 0 && m < 0.4) {
            const blend = (1 - m / 0.4) * moss;
            r = Math.round(r + (mossColor[0] - r) * blend);
            g = Math.round(g + (mossColor[1] - g) * blend);
            b = Math.round(b + (mossColor[2] - b) * blend);
          }
          const i = (y * size + x) * 4;
          imageData.data[i] = r;
          imageData.data[i + 1] = g;
          imageData.data[i + 2] = b;
          imageData.data[i + 3] = 255;
        }
      }

      ctx.putImageData(imageData, 0, 0);

      preview.width = size;
      preview.height = size;
      preview.getContext("2d").drawImage(canvas, 0, 0);

      const tiles = 4;
      tiled.width = size * tiles;
      tiled.height = size * tiles;
      const tctx = tiled.getContext("2d");
      for (let ty = 0; ty < tiles; ty++) {
        for (let tx = 0; tx < tiles; tx++) {
          tctx.drawImage(canvas, tx * size, ty * size, size, size);
        }
      }

      lastCanvas = canvas;
    }

    let lastCanvas = null;

    document.getElementById("generate").addEventListener("click", generate);
    document.getElementById("download").addEventListener("click", () => {
      if (!lastCanvas) return;
      const a = document.createElement("a");
      a.download = "forest-floor-" + lastCanvas.width + ".png";
      a.href = lastCanvas.toDataURL("image/png");
      a.click();
    });

    generate();
  </script>
</body>
</html>
